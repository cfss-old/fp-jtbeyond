---
title: "<b>Exploratory Analysis</b>"
output:
  html_document:
    theme: cosmo
---
```{r setup, include = FALSE}
library(tidyverse)
library(feather)
library (knitr)
library(tidytext)
library(DT)

df<-read_feather("data/df")

top_1986<-read_feather("data/model1986_top6") %>%
  select (word, En, estimate, std.error, p.value)
names(top_1986)<- c("Chinese word", "Engish translation", "predicted frequency","standard error", "p-value")

top_1989<-read_feather("data/model1989_top6") %>%
  select (word, En, estimate, std.error, p.value) 
names(top_1989)<- c("Chinese word", "Engish translation", "predicted frequency","standard error", "p-value")
```

This page contains a preliminary analysis of official discourse change. Here we trace change of frequency of appearance in the People's Daily during the months after intensive military repressionss for both movements.

***
## Interactive Table

First, we provide an interactive table to present counts of terms in the front page of People's Daily on each day from May 4, 1989 to July 3, 1989. This table may help get some sense of the terms that appear in the People's Daily at that period of time. Sort dates, terms, and word counts using the arrow next to each column name.
<br>

***
```{r DTtable, echo = FALSE}

data.table<-read_feather("data/df") %>%
  select(Datetime, term, count) %>%
  filter (count > 10) %>%
  filter(Datetime >= as.Date("1989-05-04") & Datetime <= as.Date("1989-07-03"))
  

datatable (data.table, rownames = FALSE, 
           options = list(columnDefs = list(list(className = 'dt-center', targets = 0:2))))  

```
<br>

***
## Binomial Statistical Analysis of Word Frequency Change
<br>
Afterwards, we conduct binomial statistical analysis to trace changes of frequency of key terms during the month immediately after the military repression for both movements. In both graphs as follows, dots represent terms, x-axis represents the change of appearance probability of given terms over one month. Positive numbers mark increases in frequency. Y-axis marks the p-value of frequency change. To be clear, we only present 50 terms whose extents of frequency change are the most among all words, and changes for all these selected terms are significant at the .05 level. 
<br>
<br>


```{r fig.width=4, fig.height=4,echo=FALSE,out.extra='style="fixed:left"'}
df1989<- df %>%
  filter(Datetime >= as.Date("1989-06-04") & Datetime <= as.Date("1990-06-04")) %>%
  separate (year_month, c("Year", "Month"), sep="-") %>%
  # since "term" will be interfered with the "term" generated by the models
  mutate (word = term)
  

data1989<-df1989 %>%
  count (Datetime, word) %>%
  ungroup() %>%
  group_by (Datetime) %>%
  mutate (day_total = sum(n),
          percent = n / day_total) %>%
  ungroup()



model1989<- data1989 %>%
  group_by(word) %>%
  filter(sum(n) > 50) %>%
  do(tidy(glm(cbind(n, day_total - n) ~ Datetime, .,
              family = "binomial"))) %>%
  ungroup() %>%
  filter (term == "Datetime") %>%
  arrange (desc(abs(estimate))) %>%
  filter (p.value <= 0.005)  



# plot the word change before and after the end of the social movement:

model1989 %>%
  mutate(adjusted.p.value = p.adjust(p.value)) %>%
  ggplot(aes(estimate, adjusted.p.value)) +
  theme_bw() + 
  geom_point() +
  scale_y_log10() +
  xlab("Estimated change over time") +
  ylab("Adjusted p-value") +
  labs(title="June 1989 - June 1990")


```
```{r fig.width=4, fig.height=4,echo=FALSE, out.extra='style="fixed:right"'}
df1986<- df %>%
  filter(Datetime >= as.Date("1986-12-27") & Datetime <= as.Date("1987-12-27")) %>%
  separate (year_month, c("Year", "Month"), sep="-") %>%
  # since "term" will be interfered with the "term" generated by the models
  mutate (word = term)
  
data1986<-df1986 %>%
  count (Datetime, word) %>%
  ungroup() %>%
  group_by (Datetime) %>%
  mutate (day_total = sum(n),
          percent = n / day_total) %>%
  ungroup()



model1986<- data1986 %>%
  group_by(word) %>%
  filter(sum(n) > 50) %>%
  do(tidy(glm(cbind(n, day_total - n) ~ Datetime, .,
              family = "binomial"))) %>%
  ungroup() %>%
  filter (term == "Datetime") %>%
  arrange (desc(abs(estimate))) %>%
  filter (p.value <= 0.005) 

# plot the word change before and after the end of the social movement:

model1986 %>%
  mutate(adjusted.p.value = p.adjust(p.value)) %>%
  ggplot(aes(estimate, adjusted.p.value)) +
  theme_bw() + 
  geom_point() +
  scale_y_log10() +
  xlab("Estimated change over time") +
  ylab("Adjusted p-value") +
  labs(title="December 1986 - December 1987")
```
<br>
<br>

These graphs present interesting findings. During the month after the military repression of the 1986 Student Demonstration, most of these significant terms experience an increase in frequency. However, for the case of Tiananmen Square Protest in 1989, the opposite trend is observed. Most of the key terms experience a decrease in word frequency. This suggests that there are denser discourses immediately following the 1989 movement, while the opposite is the case for the 1986 Student Demonstration. 

In the following two tables, we provide tables to show those terms that change most abruptly during the month after the repression for both events. First we present the result table for the 1986 Student Demonstration, with the English translation of the key terms:
<br>

```{r Table-1, echo=FALSE}
kable(top_1986, digits=5, align ="c")

```

Then we present the table for the Tiananmen Square Protest in 1989:
<br>

```{r Table-2, echo=FALSE}
kable(top_1989, digits=5, align ="c")

```
<br>

***
## Tentative Visualization of Selected Key Words
<br>
What are the relationships between characteristics of key words and their changes of frequency? To preliminary examine such relationships, we tentatively select four word pairs and plot their frequency change during the months after the repression of two movement events:


```{r fig.width=4, fig.height=4,echo=FALSE,out.extra='style="fixed:left"'}
df<-read_feather("data/df") %>%
  select(Datetime, term, count) %>%
  group_by (Datetime, term) %>%
  summarise (count=sum(count)) %>%
  ungroup()

wordlist3=c("资产阶级自由化", "安定团结")

df %>%
  filter(Datetime >= as.Date("1986-10-01") & Datetime <= as.Date("1987-12-01")) %>%
  filter (term %in% wordlist3) %>%
  mutate (en_term=ifelse(term=="资产阶级自由化", "bourgeois liberalism", "stability and unity")) %>%
  complete(Datetime, en_term, fill =list (count=0)) %>%
  ggplot(aes(x=Datetime, y=count, color=en_term)) +
  theme_bw()+
  geom_line()+
  labs(title="1986 -1987", 
       subtitle="Bourgeois Liberalism vs. Stability and Unity",
       x="date", y="Count")+
  theme(legend.title=element_blank(), legend.position="bottom") 

 
```
```{r fig.width=4, fig.height=4,echo=FALSE, out.extra='style="fixed:right"'}
wordlist4 = c("建设", "四项")

df %>%
  filter(Datetime >= as.Date("1986-12-01") & Datetime <= as.Date("1987-12-01")) %>%
  filter (term %in% wordlist4) %>%
  mutate (en_term=ifelse(term=="四项", "Four Principles","Economic Construction")) %>%
  complete(Datetime, en_term, fill =list (count=0)) %>%
  ggplot(aes(x=Datetime, y=count, color=en_term)) +
  theme_bw()+
  geom_line()+
  labs(title="1986 -1987", 
       subtitle="Economic Construction vs. Four Principles",
       x="date", y="Count")+
  theme(legend.title=element_blank(), legend.position="bottom") 
```

```{r fig.width=4, fig.height=4,echo=FALSE,out.extra='style="fixed:left"'}
wordlist1=c("动乱", "暴乱")

df %>%
  filter(Datetime >= as.Date("1989-04-01") & Datetime <= as.Date("1990-06-04")) %>%
  filter (term %in% wordlist1)%>%
  mutate (en_term=ifelse(term=="动乱", "Unrest", "Riots")) %>%
  complete(Datetime, en_term, fill =list (count=0)) %>%
  ggplot(aes(x=Datetime, y=count, color=en_term)) +
  theme_bw()+
  geom_line()+
  labs(title="1989 -1990", 
       subtitle="Unrest vs. Riots",
       x="date", y="count (per day)")+
  theme(legend.title=element_blank(), legend.position="bottom")

```
```{r fig.width=4, fig.height=4,echo=FALSE, out.extra='style="fixed:right"'}
wordlist2=c("反革命", "稳定")

df %>%
  filter(Datetime >= as.Date("1989-05-01") & Datetime <= as.Date("1990-06-04")) %>%
  filter (term %in% wordlist2)%>%
  mutate (en_term=ifelse(term=="反革命","Counter-revolution","Stability")) %>%
  complete(Datetime, en_term, fill =list (count=0)) %>%
  ggplot(aes(x=Datetime, y=count, color=en_term)) +
  theme_bw()+
  geom_line()+
  labs(title="1989 -1990", 
       subtitle="Counter-revolution vs. Stability",
       x="date", y="count (per day)")+
  theme(legend.title=element_blank(), legend.position="bottom")


```

The graphs shows fascinating results. The word pairs we choose are pairs of a more ideological term and a rather ideology-free term. For instance, "bourgeois liberalism" has relative high ideological level and was used by the Chinese government to attack those individuals whose behaviors and discourses deviate from principles of socialism. In comparision, "stability and unity" contains little ideological representation. Similarly, from the authoritarian state's perspective "riot" usually carries negative emotional meanings, while "unrest" is rather neutral emotionally and ideologically. In all four graphs, words with strong ideological meanings are plotted in red lines, while those with rather weaker ideological meanings are plotted in green lines. It could be found that those representations of strong ideology maintain their frequency of appearance even one year after the movement repression, while those of weaker ideology deterioriate soon after the repression. 

These visualized findings seem to indicate that Chinese authoritarian government use discourses with strong ideology much less after the 1989 Movement compared to after the 1986 Student Demonstration. The next tab in this website further explores this topic through deeper graphic analysis. 

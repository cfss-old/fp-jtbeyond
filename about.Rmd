---
title: "Source and Methods"
output:
  html_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(feather)
library (knitr)
library(tidytext)

df<-read_feather("data/df")
```



In this section, we explore the data through building the model for the word frequency before and after the student movement in 1986 and 1989 respectively. 


```{r fig.width=4, fig.height=4,echo=FALSE,out.extra='style="float:left"'}
df1989<- df %>%
  filter(Datetime >= as.Date("1989-06-04") & Datetime <= as.Date("1990-06-04")) %>%
  separate (year_month, c("Year", "Month"), sep="-") %>%
  # since "term" will be interfered with the "term" generated by the models
  mutate (word = term)
  

data1989<-df1989 %>%
  count (Datetime, word) %>%
  ungroup() %>%
  group_by (Datetime) %>%
  mutate (day_total = sum(n),
          percent = n / day_total) %>%
  ungroup()



model1989<- data1989 %>%
  group_by(word) %>%
  filter(sum(n) > 50) %>%
  do(tidy(glm(cbind(n, day_total - n) ~ Datetime, .,
              family = "binomial"))) %>%
  ungroup() %>%
  filter (term == "Datetime") %>%
  arrange (desc(abs(estimate))) %>%
  filter (p.value <= 0.005)  



# plot the word change before and after the end of the social movement:

model1989 %>%
  mutate(adjusted.p.value = p.adjust(p.value)) %>%
  ggplot(aes(estimate, adjusted.p.value)) +
  theme_bw() + 
  geom_point() +
  scale_y_log10() +
  xlab("Estimated change over time") +
  ylab("Adjusted p-value") +
  labs(title="June 1989 - June 1990")


```
```{r fig.width=4, fig.height=4,echo=FALSE, out.extra='style="float:right"'}
df1986<- df %>%
  filter(Datetime >= as.Date("1986-12-27") & Datetime <= as.Date("1987-12-27")) %>%
  separate (year_month, c("Year", "Month"), sep="-") %>%
  # since "term" will be interfered with the "term" generated by the models
  mutate (word = term)
  
data1986<-df1986 %>%
  count (Datetime, word) %>%
  ungroup() %>%
  group_by (Datetime) %>%
  mutate (day_total = sum(n),
          percent = n / day_total) %>%
  ungroup()



model1986<- data1986 %>%
  group_by(word) %>%
  filter(sum(n) > 50) %>%
  do(tidy(glm(cbind(n, day_total - n) ~ Datetime, .,
              family = "binomial"))) %>%
  ungroup() %>%
  filter (term == "Datetime") %>%
  arrange (desc(abs(estimate))) %>%
  filter (p.value <= 0.005) 

# plot the word change before and after the end of the social movement:

model1986 %>%
  mutate(adjusted.p.value = p.adjust(p.value)) %>%
  ggplot(aes(estimate, adjusted.p.value)) +
  theme_bw() + 
  geom_point() +
  scale_y_log10() +
  xlab("Estimated change over time") +
  ylab("Adjusted p-value") +
  labs(title="December 1986 - December 1987")


```





![](graph/.png)


